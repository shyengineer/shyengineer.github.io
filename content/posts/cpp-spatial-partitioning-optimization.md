---
title: "C++ 성능의 한계를 돌파하라: 공간 분할(Spatial Partitioning)로 수만 개의 입자 다루기!!"
date: 2026-01-26
categories: [Programming, Physics]
tags: [C++, OOP, SpatialPartitioning, Optimization, PhysicsEngine]
math: true
comments: true
draft: false
summary: "입자가 늘어날수록 급격히 느려지는 시뮬레이션! 모든 객체를 일일이 대조하지 않고, 필요한 영역만 효율적으로 탐색하는 공간 분할 기법의 마법을 공개합니다!!"
---

## 1. 자! '성능의 벽'에 부딪히셨나요?

지난 시간에 우리는 **업데이트 루프**를 통해 모든 입자를 순회하는 법을 배웠습니다!! 하지만 입자가 1,000개를 넘어 10,000개가 되면 어떻게 될까요? 

특히 입자끼리 충돌하거나 서로 영향을 주고받는 경우, 모든 입자를 서로 대조하면 계산량이 $O(n^2)$으로 폭증하게 됩니다!! 즉, 입자가 10배 늘어나면 계산은 100배나 힘들어지는 거죠!! 이 문제를 해결할 구원투수가 바로 **공간 분할(Spatial Partitioning)**입니다!!

---

## 2. 공간 분할: "근처에 있는 애들만 신경 써!!"

공간 분할의 핵심 아이디어는 아주 단순합니다!! 광활한 물리 세계를 여러 개의 **'구역(Grid/Cell)'**으로 나누는 것이죠!!



* **기존 방식:** 모든 입자(A)가 세상의 모든 입자(B, C, D...)와 부딪히는지 확인합니다!! (매우 비효율적!!)
* **공간 분할 방식:** 입자(A)가 속한 칸과 그 주변 칸에 있는 친구들하고만 대조합니다!! 멀리 있는 입자들은 아예 무시하는 거죠!! 정말 똑똑하죠?

---

## 3. C++ Grid 기반 공간 분할 구현 예시!!

우리 관리자인 `PhysicsWorld`에 그리드 시스템을 도입해 봅시다!!

```cpp
#include <vector>
#include <map>

// 공간을 나누는 칸(Cell)의 크기
const int CELL_SIZE = 50;

class SpatialGrid {
private:
    // 좌표를 키(Key)로 사용해 해당 구역의 입자들을 관리합니다!!
    std::map<std::pair<int, int>, std::vector<Particle*>> grid;

public:
    // 입자의 위치에 따라 적절한 칸에 배치합니다!!
    void registerParticle(Particle* p) {
        int cellX = static_cast<int>(p->getPosition().x / CELL_SIZE);
        int cellY = static_cast<int>(p->getPosition().y / CELL_SIZE);
        grid[{cellX, cellY}].push_back(p);
    }

    void clear() { grid.clear(); }

    // 특정 구역 주변의 입자들만 가져오는 마법!!
    std::vector<Particle*> getNearby(Particle* p) {
        // ... 주변 9개 칸의 입자들만 모아서 반환하는 로직 ...
    }
};
```
## 4. 왜 공간 분할이 성능을 극한으로 끌어올릴까요?
불필요한 계산 제거: 수천 번의 연산이 단 몇 번의 연산으로 줄어듭니다!! 연산 복잡도가 거의 $O(n)$에 가까워지는 기적을 볼 수 있어요!!

메모리 캐시 효율: 근처에 있는 데이터를 연속적으로 처리하므로 CPU가 아주 좋아합니다!!

확장성: 이제 입자가 수만 개가 되어도 시뮬레이션이 멈추지 않고 매끄럽게 돌아갑니다!!

## 5. 경제 시뮬레이션에서의 응용: 로컬 시장!!
이 기법은 경제학의 **'지역 시장 모델'**과 같습니다!! 전 세계의 모든 소비자와 기업이 실시간으로 상호작용하는 것은 불가능하죠.

대신 **'물류 거점'**이나 **'지역 상권'**이라는 공간적 제약을 두어, 그 안의 경제 주체들끼리 우선 거래하게 설계하면 훨씬 현실적이고 빠른 시뮬레이션이 가능해집니다!!

💡 성능의 마법사가 되어보신 소감이 어떠신가요?
공간 분할은 현대 게임 엔진과 대규모 시뮬레이션의 필수 기술입니다!! 여러분의 엔진에 이 기법을 적용하는 순간, 상상만 하던 거대한 세계를 직접 움직일 수 있게 될 거예요!!

혹시 그리드 방식보다 더 정교한 **쿼드트리(Quad-tree)**나 **옥트리(Oc-tree)**가 궁금하신가요?

여러분의 다음 도전 과제를 댓글로 알려주세요!! 제가 끝까지 함께하겠습니다!!